{% extends "core/base.html" %}
{% block content %}
<main class="flex-1 px-12 py-8">
  <h1 class="text-3xl font-bold mb-8">Orders Dashboard</h1>

  <!-- üîé Filter & Search -->
  <form method="get" class="mb-6 flex gap-4">
    <select name="status" class="border rounded px-3 py-2">
      <option value="">All Status</option>
      {% for key, label in orders.model.STATUS_CHOICES %}
        <option value="{{ key }}" {% if request.GET.status == key %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
    <input type="text" name="order_id" value="{{ request.GET.order_id }}" placeholder="Search Order ID" class="border rounded px-3 py-2">
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Apply</button>
  </form>

  <div class="overflow-x-auto bg-white rounded-lg shadow border">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Order ID</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Customer</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Receiver Info</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Products</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Total</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Date</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        {% for order in orders %}
        <tr>
          <td class="px-6 py-4 text-sm font-medium text-gray-900">#{{ order.id }}</td>
          <td class="px-6 py-4 text-sm text-gray-700">{{ order.user.username }} <br> {{ order.user.email }}</td>
          <td class="px-6 py-4 text-sm text-gray-700">
            <p class="font-medium text-gray-900">{{ order.receiver_name }}</p>
            <p>üìû {{ order.receiver_phone }}</p>
            <p>üìç {{ order.shipping_address }}</p>
          </td>
          <td class="px-6 py-4 text-sm text-gray-700">
            <ul class="list-disc ml-4">
              {% for item in order.items.all %}
              <li>{{ item.product.name }} (x{{ item.quantity }}) ‚Äì ‚Çπ{{ item.total_price }}</li>
              {% endfor %}
            </ul>
          </td>
          <td class="px-6 py-4 text-sm font-bold text-gray-900">‚Çπ{{ order.total_amount }}</td>
          <td class="px-6 py-4 text-sm">
            <!-- ‚úÖ Status Change Form -->
            <form method="post" action="{% url 'adminpanel:update_order_status' order.id %}">
              {% csrf_token %}
              <select name="status" onchange="this.form.submit()" class="border rounded px-2 py-1 text-sm">
                {% for key, label in order.STATUS_CHOICES %}
                  <option value="{{ key }}" {% if order.status == key %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
              </select>
            </form>
          </td>
          <td class="px-6 py-4 text-sm text-gray-600">{{ order.created_at|date:"M d, Y H:i" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="px-6 py-4 text-center text-gray-500">No orders yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</main>
{% endblock %}
